<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - VanConnect</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="login.css">
</head>

<body>
    <div class="login-container">
        <div class="back-to-home">
            <a href="../../index.html">&larr; Voltar para o Início</a>
        </div>
        <h2 class="text-center mb-4">VanConnect</h2>

        <ul class="nav nav-tabs" id="loginTab" role="tablist">
            <li class="nav-item" role="presentation"><button class="nav-link active" id="user-tab" data-bs-toggle="tab"
                    data-bs-target="#user-tab-pane" type="button" role="tab">Passageiro</button></li>
            <li class="nav-item" role="presentation"><button class="nav-link" id="driver-tab" data-bs-toggle="tab"
                    data-bs-target="#driver-tab-pane" type="button" role="tab">Motorista</button></li>
            <li class="nav-item" role="presentation"><button class="nav-link" id="admin-tab" data-bs-toggle="tab"
                    data-bs-target="#admin-tab-pane" type="button" role="tab">Admin</button></li>
        </ul>

        <div class="tab-content" id="loginTabContent">
            <div class="tab-pane fade show active" id="user-tab-pane" role="tabpanel">
                <form id="login-form-usuario" class="mt-4">
                    <div class="mb-3"><label for="user-login" class="form-label">Usuário (login)</label><input
                            type="text" class="form-control" id="user-login" required></div>
                    <div class="mb-3"><label for="user-password" class="form-label">Senha</label><input type="password"
                            class="form-control" id="user-password" required></div>
                    <button type="submit" class="btn cta-button w-100">Entrar</button>
                    <p class="text-center mt-3"><a href="#" data-bs-toggle="modal" data-bs-target="#registerModal">Não
                            tem uma conta? Registre-se</a></p>
                </form>
            </div>
            <div class="tab-pane fade" id="driver-tab-pane" role="tabpanel">
                <form id="login-form-motorista" class="mt-4">
                    <div class="mb-3"><label for="driver-login" class="form-label">Usuário (login)</label><input
                            type="text" class="form-control" id="driver-login" required></div>
                    <div class="mb-3"><label for="driver-password" class="form-label">Senha</label><input
                            type="password" class="form-control" id="driver-password" required></div>
                    <button type="submit" class="btn cta-button w-100">Entrar</button>
                    <p class="text-center mt-3"><a href="#" data-bs-toggle="modal"
                            data-bs-target="#driverRegisterModal">Não tem uma conta? Registre-se como motorista</a></p>
                </form>
            </div>
            <div class="tab-pane fade" id="admin-tab-pane" role="tabpanel">
                <form id="login-form-admin" class="mt-4">
                    <div class="mb-3"><label for="admin-login" class="form-label">Usuário (login)</label><input
                            type="text" class="form-control" id="admin-login" required></div>
                    <div class="mb-3"><label for="admin-password" class="form-label">Senha</label><input type="password"
                            class="form-control" id="admin-password" required></div>
                    <button type="submit" class="btn cta-button w-100">Entrar</button>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="registerModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="registerModalLabel">Registrar Novo Usuário</h5><button type="button"
                        class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="register-form">
                        <div class="form-group mb-2"><label for="txt_nome">Nome completo</label><input type="text"
                                id="txt_nome" class="form-control" required></div>
                        <div class="form-group mb-2"><label for="txt_login">Usuário (login)</label><input type="text"
                                id="txt_login" class="form-control" required></div>
                        <div class="form-group mb-2"><label for="txt_email">Email</label><input type="email"
                                id="txt_email" class="form-control" required></div>
                        <div class="form-group mb-2"><label for="txt_celular">Celular</label><input type="tel"
                                id="txt_celular" class="form-control" required placeholder="(XX) XXXXX-XXXX"></div>
                        <div class="form-group mb-2"><label for="txt_senha">Senha</label><input type="password"
                                id="txt_senha" class="form-control" required></div>
                        <div class="form-group mb-2"><label for="txt_senha2">Confirmação de Senha</label><input
                                type="password" id="txt_senha2" class="form-control" required></div>
                    </form>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary"
                        data-bs-dismiss="modal">Cancelar</button><button type="button" id="btn_salvar_registro"
                        class="btn btn-info">Salvar</button></div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="driverRegisterModal" tabindex="-1" aria-labelledby="driverRegisterModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="driverRegisterModalLabel">Cadastro de Motorista</h5><button
                        type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="driver-register-form">
                        <div class="row">
                            <div class="col-md-6">
                                <h5>Dados Pessoais e de Acesso</h5>
                                <div class="form-group mb-2"><label for="driver-reg-nome">Nome Completo</label><input
                                        type="text" id="driver-reg-nome" class="form-control" required></div>
                                <div class="form-group mb-2"><label for="driver-reg-email">Email de
                                        Contato</label><input type="email" id="driver-reg-email" class="form-control"
                                        required></div>
                                <div class="form-group mb-2"><label for="driver-reg-phone">Telefone</label><input
                                        type="tel" id="driver-reg-phone" class="form-control" required></div>
                                <div class="form-group mb-2"><label for="driver-reg-login">Login de Acesso</label><input
                                        type="text" id="driver-reg-login" class="form-control" required></div>
                                <div class="form-group mb-2"><label for="driver-reg-senha">Senha</label><input
                                        type="password" id="driver-reg-senha" class="form-control" required></div>
                            </div>
                            <div class="col-md-6">
                                <h5>Dados do Veículo Principal</h5>
                                <div class="form-group mb-2"><label for="driver-reg-model">Modelo</label><input
                                        type="text" id="driver-reg-model" class="form-control" required></div>
                                <div class="form-group mb-2"><label for="driver-reg-plate">Placa</label><input
                                        type="text" id="driver-reg-plate" class="form-control" required></div>
                                <div class="form-group mb-2"><label for="driver-reg-capacity">Capacidade (Nº de
                                        lugares)</label><input type="number" id="driver-reg-capacity"
                                        class="form-control" required></div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary"
                        data-bs-dismiss="modal">Cancelar</button><button type="button" id="btn_salvar_driver_registro"
                        class="btn btn-info">Cadastrar</button></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="login.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const userLoginForm = document.getElementById('login-form-usuario');
            const driverLoginForm = document.getElementById('login-form-motorista');
            const adminLoginForm = document.getElementById('login-form-admin');
            const saveUserBtn = document.getElementById('btn_salvar_registro');
            const saveDriverBtn = document.getElementById('btn_salvar_driver_registro');
            const userRegisterModal = new bootstrap.Modal(document.getElementById('registerModal'));
            const driverRegisterModal = new bootstrap.Modal(document.getElementById('driverRegisterModal'));

            const handleLogin = async (event, formType) => {
                event.preventDefault();
                const login = document.getElementById(`${formType}-login`).value;
                const password = document.getElementById(`${formType}-password`).value;
                const success = await Auth.login(login, password);
                if (success) {
                    Auth.redirectAfterLogin();
                } else {
                    alert('Usuário ou senha incorretos.');
                }
            };

            userLoginForm.addEventListener('submit', (e) => handleLogin(e, 'user'));
            driverLoginForm.addEventListener('submit', (e) => handleLogin(e, 'driver'));
            adminLoginForm.addEventListener('submit', (e) => handleLogin(e, 'admin'));

            saveUserBtn.addEventListener('click', async () => {
                const nome = document.getElementById('txt_nome').value;
                const login = document.getElementById('txt_login').value;
                const email = document.getElementById('txt_email').value;
                const celular = document.getElementById('txt_celular').value;
                const senha = document.getElementById('txt_senha').value;
                const senha2 = document.getElementById('txt_senha2').value;

                if (senha !== senha2) { alert('As senhas não conferem.'); return; }
                if (!nome || !login || !email || !senha || !celular) { alert('Por favor, preencha todos os campos.'); return; }

                const success = await Auth.register(nome, login, senha, email, celular);
                if (success) {
                    alert('Usuário registrado com sucesso! Você já pode fazer o login.');
                    document.getElementById('register-form').reset();
                    userRegisterModal.hide();
                } else {
                    alert('Erro ao registrar. O login ou email pode já estar em uso.');
                }
            });

            saveDriverBtn.addEventListener('click', async () => {
                const driverData = {
                    nome: document.getElementById('driver-reg-nome').value,
                    email: document.getElementById('driver-reg-email').value,
                    phone: document.getElementById('driver-reg-phone').value,
                    login: document.getElementById('driver-reg-login').value,
                    senha: document.getElementById('driver-reg-senha').value,
                    vehicleModel: document.getElementById('driver-reg-model').value,
                    vehiclePlate: document.getElementById('driver-reg-plate').value,
                    vehicleCapacity: document.getElementById('driver-reg-capacity').value,
                };

                for (const key in driverData) {
                    if (!driverData[key]) {
                        alert("Por favor, preencha todos os campos do cadastro de motorista.");
                        return;
                    }
                }

                const success = await Auth.registerDriver(driverData);
                if (success) {
                    alert('Cadastro de motorista realizado com sucesso! Você já pode fazer o login.');
                    document.getElementById('driver-register-form').reset();
                    driverRegisterModal.hide();
                } else {
                    alert('Erro ao realizar o cadastro. Verifique se o login ou email já existem.');
                }
            });
        });
    </script>
</body>

</html>